# 2_Generate_figures.Rmd#

This script is to generate figures for Simple HIV model.

```{r Generate figures for number of new infections}
#basePath <- getwd()
#source(file.path(basePath, "1_input and run model.Rmd"))
library(ggplot2)

newinfectionfig<-ggplot(data = newinfectionresults,          
       aes(x = timestep, y = newHIV, colour = scenarios, group = scenarios)) +  
  # in the long-format output dataset, the number in each compartment
  # is in the "value" column and the compartment the number relates 
  # to is in the "variable" column. We are telling ggplot to assign a 
  # different colour to each compartment/group, which automatically 
  # generates a legend
  geom_line() +                                                          
  # we want to represent the data over time as lines. 
  # This command automatically looks to the specifications saved
  # in the ggplot command above to know which data to plot
  xlab(paste0("Time (", projectSpecs$stepsize, ")"))+    # add label for x axis
  ylab("Number of new HIV infections") +
  labs(title = paste("Impact of different scenarios on HIV epidemic"))+
  scale_x_continuous(breaks = c(1,7,13,19,25,31), 
                     labels = c("Jan-2020","July-2020","Jan-2021","July-2021","Jan-2022","July-2022"))+
  ylim(0,signif(max(newinfectionresults$newHIV)*2,1))

#General code to generate figure:  
#  scale_x_continuous(breaks = 0:(projectSpecs$steps-1), 
#                     labels = c(projectSpecs$startyear,
#                     as.character(1:(projectSpecs$steps-1))))+
#  ylim(0,signif(max(newinfectionresults$newHIV)*2,1))

newinfectionfig
#yscaleFactor <- 100
#ylim(0,ceiling(max(newinfectionresults$newHIV)/yscaleFactor) * yscaleFactor)

###generate cumulated new infections###
cumulatedinfectionfig<-ggplot(data = newinfectionresults,          
       aes(x = timestep, y = csum, colour = scenarios, group = scenarios)) +  
  # in the long-format output dataset, the number in each compartment
  # is in the "value" column and the compartment the number relates 
  # to is in the "variable" column. We are telling ggplot to assign a 
  # different colour to each compartment/group, which automatically 
  # generates a legend
  geom_line() +                                                          
  # we want to represent the data over time as lines. 
  # This command automatically looks to the specifications saved
  # in the ggplot command above to know which data to plot
  xlab(paste0("Time (", projectSpecs$stepsize, ")"))+    # add label for x axis
  ylab("Cumulated number of new HIV infections") +
  labs(title = paste("Impact of different scenarios on HIV epidemic"))+
  scale_x_continuous(breaks = c(1,7,13,19,25,31), 
                     labels = c("Jan-2020","July-2020","Jan-2021","July-2021","Jan-2022","July-2022"))+
  ylim(0,(trunc(max(newinfectionresults$csum)/500)+1)*500)

cumulatedinfectionfig

SaveFigure <- function(folder, filename, figure, 
    format = ".png", width = 20, 
    height = 10, units = "cm", ...) {
    ggsave(file.path(folder, paste(filename, format, sep = "")), 
      plot = figure, width = width, height = height, units = units, ...)
}

# If figure not already created make sure it is not overwritten
if (!file.exists(file.path(figFolder, "cumulated_HIV_infection1213_2.png"))) {
    SaveFigure(figFolder,"cumulated_HIV_infection1213_2",cumulatedinfectionfig)
}
if (!file.exists(file.path(figFolder, "new_HIV_infection1213_2.png"))) {
    SaveFigure(figFolder,"new_HIV_infection1213_2",newinfectionfig)
}

```

```{r Generate figures for cumulated number of infections}

totalinfectionfig<-ggplot(data = totalinfectionresults,          
       aes(x = timestep, y = totalHIV, colour = scenarios, group = scenarios)) +  
  # in the long-format output dataset, the number in each compartment
  # is in the "value" column and the compartment the number relates 
  # to is in the "variable" column. We are telling ggplot to assign a 
  # different colour to each compartment/group, which automatically 
  # generates a legend
  geom_line() +                                                          
  # we want to represent the data over time as lines. 
  # This command automatically looks to the specifications saved
  # in the ggplot command above to know which data to plot
  xlab("Time (month)")+                          # add label for x axis
  ylab("Number of PLHIV in AU") +
  labs(title = paste("Impact of different scenarios on HIV epidemic"))+
  scale_x_continuous(breaks = c(1,7,13,19,25,31), 
                     labels = c("Jan-2020","July-2020","Jan-2021","July-2021","Jan-2022","July-2022"))+
#For general code:
#  scale_x_continuous(breaks = 0:(projectSpecs$steps-1), 
#                     labels = c(projectSpecs$startyear,
#                     as.character(1:(projectSpecs$steps-1))))+
  ylim((trunc(min(totalinfectionresults$totalHIV)/5000))*5000,(trunc(max(totalinfectionresults$totalHIV)/5000)+1)*5000)
totalinfectionfig

# If figure not already created make sure it is not overwritten
if (!file.exists(file.path(figFolder, "total_HIV_infection1213_2.png"))) {
    SaveFigure(figFolder,"total_HIV_infection1213_2",totalinfectionfig)
}


```


